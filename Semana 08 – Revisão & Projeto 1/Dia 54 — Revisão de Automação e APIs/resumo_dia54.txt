üìò Resumo do Dia 54: Automa√ß√£o SOC e Integra√ß√£o de APIs

Data: 20 de Novembro de 2025
Foco: Automa√ß√£o com Python, Requisi√ß√µes HTTP, Manipula√ß√£o de JSON/CSV e Threat Intelligence.
Objetivo: Criar ferramentas que automatizam a coleta de dados de IPs suspeitos para agilizar a resposta a incidentes.

1. O Papel da Automa√ß√£o no SOC

A automa√ß√£o n√£o substitui o analista, mas remove o trabalho repetitivo ("bra√ßal"). Em um SOC moderno, Python √© usado para:

Reduzir o MTTR (Mean Time to Respond): Coleta de dados em segundos, n√£o minutos.

Enriquecimento de Dados: Consultar m√∫ltiplas fontes (GeoIP, Reputa√ß√£o, Whois) automaticamente.

Padroniza√ß√£o: Garantir que todo incidente seja analisado com o mesmo rigor.

2. Ferramentas e Bibliotecas Essenciais

üêç Biblioteca requests

O padr√£o ouro para fazer o Python "conversar" com a internet.

import requests

# Estrutura b√°sica de uma consulta GET
resposta = requests.get("[https://api.exemplo.com/dados](https://api.exemplo.com/dados)")

# Verifica√ß√£o de sucesso (HTTP 200 OK)
if resposta.status_code == 200:
    dados = resposta.json() # Converte a resposta para Dicion√°rio Python


üìÑ Formato JSON

O JSON (JavaScript Object Notation) √© a linguagem universal das APIs. O Python o trata como um Dicion√°rio (chave: valor).


üìä Manipula√ß√£o de CSV

Essencial para gerar relat√≥rios que podem ser abertos no Excel ou importados para um SIEM.

import csv

with open("relatorio.csv", "w", newline="") as f:
    writer = csv.writer(f)
    writer.writerow(["IP", "Pa√≠s", "Risco"]) # Cabe√ßalho
    writer.writerow(["8.8.8.8", "US", "Baixo"]) # Dados


3. Workflow de um Script de Intelig√™ncia de Amea√ßas

Todo script de automa√ß√£o SOC segue um fluxo l√≥gico de 5 etapas:

Input (Entrada): Ler uma lista de alvos (ex: arquivo suspeitos.txt ou input do usu√°rio).

Enriquecimento (Processamento): Para cada alvo, consultar APIs externas.

GeoIP (Onde est√°?): ipinfo.io, ip-api.com

Reputa√ß√£o (√â malicioso?): AbuseIPDB, VirusTotal

Parsing (Tratamento): Extrair apenas o necess√°rio do JSON (Pa√≠s, ASN, Score de Risco).

Output (Sa√≠da): Salvar em arquivo consolidado (.csv, .json).

A√ß√£o (Resposta): Exibir alerta no terminal, enviar e-mail ou Webhook (Discord/Slack).

4. C√≥digo de Refer√™ncia: O "Mini-SOC"

Abaixo, o script consolidado que integra leitura de arquivo, consulta a API, l√≥gica de decis√£o (IF) e gera√ß√£o de CSV.

import requests
import csv
import time
from datetime import datetime

# Configura√ß√µes
ARQUIVO_ALVOS = "suspeitos.txt"
ARQUIVO_RELATORIO = "relatorio_ameacas.csv"
API_KEY = "SUA_KEY_ABUSEIPDB" # Opcional para reputa√ß√£o

def consultar_ip(ip):
    """Consulta dados b√°sicos e reputa√ß√£o"""
    dados = {"ip": ip, "pais": "N/A", "org": "N/A", "risco": 0}
    
    # 1. GeoIP (IPInfo)
    try:
        resp = requests.get(f"[https://ipinfo.io/](https://ipinfo.io/){ip}/json", timeout=5)
        if resp.status_code == 200:
            json_data = resp.json()
            dados["pais"] = json_data.get("country", "N/A")
            dados["org"] = json_data.get("org", "N/A")
    except: pass

    # 2. Reputa√ß√£o (AbuseIPDB - Exemplo Conceitual)
    # (Adicionar l√≥gica de requests aqui se tiver chave)
    
    return dados

# Fluxo Principal
print("üõ°Ô∏è Iniciando An√°lise de Amea√ßas...")

try:
    with open(ARQUIVO_ALVOS, "r") as f:
        ips = [line.strip() for line in f if line.strip()]
        
    resultados = []
    
    print(f"üìã Analisando {len(ips)} endere√ßos IP...\n")

    for ip in ips:
        info = consultar_ip(ip)
        
        # L√≥gica de Alerta SOC
        if info["pais"] not in ["BR", "US"] or "BadActor" in info["org"]:
             print(f"‚ö†Ô∏è ALERTA: {ip} ({info['pais']}) - Origem Suspeita!")
        else:
             print(f"‚úÖ Limpo: {ip}")
             
        info["data_analise"] = datetime.now().strftime("%Y-%m-%d %H:%M")
        resultados.append(info)
        time.sleep(1) # Rate Limit (√âtica)

    # Salvando CSV
    if resultados:
        with open(ARQUIVO_RELATORIO, "w", newline="") as csvfile:
            writer = csv.DictWriter(csvfile, fieldnames=resultados[0].keys())
            writer.writeheader()
            writer.writerows(resultados)
        print(f"\nüìÑ Relat√≥rio salvo em: {ARQUIVO_RELATORIO}")

except FileNotFoundError:
    print("Erro: Crie o arquivo 'suspeitos.txt' primeiro.")


5. Conceitos Avan√ßados (N√≠vel Profissional)

Webhooks (Discord/Slack)

Permitem que seu script envie notifica√ß√µes em tempo real para canais de chat.

Payload: √â o JSON enviado via POST para a URL do webhook.

Uso: Alerta imediato para IPs com Risk Score > 80.

Agendamento (Cron / Task Scheduler)

Scripts de seguran√ßa devem rodar sozinhos.

Linux (Cron): 0 8 * * * python3 script.py (Roda todo dia √†s 08h).

Windows: Agendador de Tarefas > Criar Tarefa B√°sica > Iniciar Programa.

Biblioteca rich

Melhora a experi√™ncia do usu√°rio (UX) no terminal com cores, tabelas e barras de progresso, facilitando a leitura visual dos alertas.

Conclus√£o

Dominar APIs e Python permite ao analista de SOC sair da "fila de tickets" e atuar na Engenharia de Detec√ß√£o, criando ferramentas que trabalham por ele e aumentam a seguran√ßa da organiza√ß√£o.